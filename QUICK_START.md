# 快速开始测试

## ⚠️ 重要提示

**蓝牙功能必须在真实iOS设备上测试，iOS模拟器不支持蓝牙！**

如果你在模拟器上运行，只能看到UI界面，无法测试蓝牙通信、语音录制等核心功能。

## 立即检查清单

### ✅ 步骤 1: 确认设备
- [ ] 使用真实iPhone/iPad（不是模拟器）
- [ ] 设备已连接到Mac
- [ ] 在Xcode中选择真实设备（不是模拟器）
- [ ] 设备已信任电脑

### ✅ 步骤 2: 运行项目
```bash
1. 打开 MetroQuickChat.xcodeproj
2. 选择你的iPhone作为目标设备
3. 按 ⌘ + R 运行
```

### ✅ 步骤 3: 检查权限（首次运行）
应用会请求以下权限，**全部允许**：
- [ ] 蓝牙权限
- [ ] 定位权限  
- [ ] 麦克风权限（语音消息）
- [ ] 照片权限（图片消息）

**如果拒绝了权限，去设置中开启：**
```
设置 → MetroQuickChat → 开启所有权限
```

### ✅ 步骤 4: 看到什么界面？

**首次运行应该看到：**
1. **OnboardingView（引导页）**
   - 显示"地铁快打"
   - 检查权限状态
   - 点击"开始使用"

2. **HomeView（主页）**
   - 底部有标签栏
   - 显示"频道列表"、"雷达扫描"等

如果看不到这些，检查：
- Xcode控制台是否有错误
- 设备屏幕是否正常显示

## 快速测试（单设备）

即使只有一台设备，也能测试UI功能：

### 测试 1: 创建频道
```
1. 点击"创建频道"
2. 输入"我的频道"
3. 点击创建
4. 应该看到频道列表出现新频道
```

### 测试 2: 进入聊天
```
1. 点击刚创建的频道
2. 进入聊天界面
3. 应该看到欢迎消息："欢迎加入 我的频道"
```

### 测试 3: 发送文本
```
1. 在输入框输入"测试消息"
2. 点击发送按钮（飞机图标）
3. 应该看到蓝色气泡消息出现
```

### 测试 4: 测试UI组件
```
1. 点击表情按钮（😊）
   → 应该打开表情选择器
   
2. 点击相机按钮（📷）
   → 应该打开图片选择器
   
3. 长按麦克风按钮（🎤）
   → 应该看到录音指示器
```

## 如果看不到效果

### 问题 1: 应用崩溃或黑屏
**检查：**
```swift
// Xcode控制台查看错误信息
// 常见错误：
// - 权限未授予
// - 蓝牙不支持（模拟器）
```

**解决：**
1. 检查Xcode控制台红色错误
2. 确保所有权限已授予
3. 使用真实设备（不是模拟器）

### 问题 2: 看不到聊天界面
**检查：**
```swift
// 是否成功创建了频道？
// 是否点击了频道卡片？
```

**解决：**
1. 确保创建了频道
2. 点击频道卡片进入聊天
3. 查看导航栏标题应为"聊天"

### 问题 3: 无法发送消息
**检查：**
```swift
// 是否在频道中？
// 输入框是否有文字？
// 发送按钮是否可用？
```

**解决：**
1. 确保输入了文字
2. 发送按钮应该是蓝色的
3. 点击后消息应该立即出现在界面

### 问题 4: 语音/图片功能不工作
**检查：**
```
设置 → MetroQuickChat → 
- 麦克风：已开启
- 照片：已开启
```

## 调试技巧

### 在Xcode中查看日志
1. 运行应用（⌘ + R）
2. 查看底部控制台
3. 查找错误信息（红色）

### 添加调试日志
如果你想看到更多信息，可以在代码中添加：

```swift
// 在 ChatView.swift 中
print("📱 ChatView loaded")
print("📨 Messages count: \(viewModel.messages.count)")

// 在 ChannelManager.swift 中
print("📡 Bluetooth state: \(central.state)")
print("💬 Message sent: \(message.text)")
```

### 使用断点调试
1. 在代码左侧点击设置断点
2. 运行应用
3. 当执行到断点时暂停
4. 查看变量值

## 预期效果速查表

| 功能 | 单设备测试 | 双设备测试 | 模拟器 |
|------|----------|----------|--------|
| UI界面 | ✅ | ✅ | ✅ |
| 创建频道 | ✅ | ✅ | ✅ |
| 发送文本 | ✅ | ✅ | ❌ |
| 发送图片 | ✅ | ✅ | ❌ |
| 发送语音 | ✅ | ✅ | ❌ |
| 蓝牙连接 | ❌ | ✅ | ❌ |
| 接收消息 | ❌ | ✅ | ❌ |

## 最常见的3个问题

### ❌ "我在模拟器上运行，看不到蓝牙功能"
**答案：** 必须使用真实设备！蓝牙是硬件功能，模拟器不支持。

### ❌ "应用打开了但是黑屏/崩溃"
**答案：** 
1. 检查Xcode控制台错误
2. 确保权限已授予
3. 清理构建（⌘ + Shift + K）重新运行

### ❌ "消息发送了但是对方收不到"
**答案：** 
1. 需要2台真实设备
2. 确保两台设备都在同一频道
3. 确保蓝牙和定位都已开启
4. 检查设备距离（建议<5米）

## 获得帮助

**如果还是看不到效果：**

1. **截图给我看：**
   - Xcode界面
   - 应用界面
   - 控制台错误

2. **告诉我：**
   - 使用什么设备（iPhone型号、iOS版本）
   - 是在模拟器还是真机
   - 具体哪个功能看不到效果
   - Xcode控制台有什么错误

3. **检查这些：**
   ```bash
   # 在终端运行
   cd /Users/james/work/code/ios/MetroQuickChat
   
   # 检查项目文件
   ls -la MetroQuickChat/
   
   # 检查Xcode是否识别项目
   xcodebuild -list -project MetroQuickChat.xcodeproj
   ```

---

**记住：蓝牙功能 = 真实设备！** 📱

